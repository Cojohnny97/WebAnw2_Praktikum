<!DOCTYPE html>
<html>
	<head>
		<title>Bestellformular</title>
		<link rel="stylesheet" type="text/css" href="style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	</head>
	<body>
		<section class="panel">
			<div class="container">		
				<a href="Startseite.html">Homepage</a>
				<div class= "überschrift"><h1><u>Lieferservice Albstadt</u></h1></div>
				<a href="warenkorb.html" id="cart">Warenkorb</a>				
			</div>
		</section>
        <div class="body">
            <h1><u>Bewerben Sie sich bei uns</u></h1>
            <br>
            <form>
                <h3 id="nachBewerbung"></h3>
                <table id="formular">
                    <tr>
                        <td> 
                            <label for="Anrede">Anrede:  </label>
                        </td>
                        <td>
                            <input type="radio" id="Herr" name="anrede" value="Herr">
                            <label for="Herr">Herr</label>
                            <input type="radio" id="Frau" name="anrede" value="Frau">
                            <label for="Frau">Frau</label>
                        </td>
                    </tr> 
                    <tr>
                        <td>
                            <label for="Vname">Vorname:  </label>
                        </td>
                        <td>
                            <input type="text" id="Vname">
                        </td>
                    </tr>
                    <tr>     
                        <td>
                            <label for="Nname">Nachname:  </label>
                        </td>
                        <td>
                            <input type="text" id="Nname">
                        </td>
                    </tr>
                    <tr> 
                        <td>
                            <label for="email">Email Adresse:  </label>
                        </td>
                        <td>
                            <input type="text" id="email">
                        </td>
                    </tr>
                    <tr>
                    <td>
                        <label for="tel">Telefonnummer:  </label>
                    </td>
                    <td>
                        <input type="number" pattern="[0-9]" id="tel">
                    </td>
                    </tr>
                    <tr> 
                        <td>
                            <label for="adresse">Adresse:   </label>
                        </td>
                        <td>
                            <input type="text" id="adresse">
                        </td>
                    </tr>
                    <tr> 
                        <td>
                            <label for="plz">Postleizahl:   </label>
                        </td>
                        <td>
                            <input type="text" id="plz">
                        </td>
                    </tr>
                    <tr> 
                        <td>
                            <label for="ort">Ort:   </label>
                        </td>
                        <td>
                            <input type="text" id="ort">
                        </td>
                    </tr>
                        <td> 
                            <label for="Anrede">Schulausbildung:  </label>
                        </td>
                        <td>
                            <input type="radio" id="Hauptschule" name="ausbildung" value="0">
                            <label for="Hauptschule">Hauptschule</label>
                            <input type="radio" id="Realschule" name="ausbildung" value="1">
                            <label for="Realschule">Realschule</label>
                            <input type="radio" id="Gymnasium" name="ausbildung" value="2">
                            <label for="Gymnasium">Gymnasium</label>
                        </td>
                    </tr> 
                    <tr>
                        <td> 
                            <label for="Anrede">Arbeitsplatz:  </label>
                        </td>
                        <td>
                            <input type="radio" id="Fahrer" name="job" value="0">
                            <label for="Fahrer">Fahrer</label>
                            <input type="radio" id="Koch" name="job" value="1">
                            <label for="Koch">Koch</label>
                            <input type="radio" id="Telefonannahme" name="job" value="2">
                            <label for="Telefonannahme">Telefonannahme</label>
                        </td>
                    </tr>
                    <tr>
                        <td> 
                            <label for="Anrede">Erfahrung:  </label>
                        </td>
                        <td>
                            <input type="radio" id="ja" name="erfahrung" value="0">
                            <label for="ja">ja</label>
                            <input type="radio" id="nein" name="erfahrung" value="1">
                            <label for="nein">nein</label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <a onclick="bewerben()">Absenden</a>
                        </td>
                    </tr>     
                </table>
            </form>
        </div>
        <section class="footer">
            <div class="container">
                <a href="impressum.html">Impressum</a>
                <a href="agb.html">AGB  </a>
                <a href="standort.html">Standort</a>
                <a href="bewerbung.html">Bewerben Sie Sich bei uns</a>			
            </div>
        </section>
	</body>
</html>

<script>
    $(document).ready(function () {
        console.log('hi')
    })

    function bewerben () {
        let anrede
        if (document.getElementById('Herr').checked || document.getElementById('Frau').checked){
            anrede = document.getElementById('Herr').checked ? 'Herr' : 'Frau'
        } else {
            anrede = ''
        }

        let schulausbildung
        if (document.getElementById('Hauptschule').checked) {
            schulausbildung = 0
        } else if (document.getElementById('Realschule').checked) {
            schulausbildung = 1
        } else if (document.getElementById('Gymnasium').checked) {
            schulausbildung = 2
        } else {
            schulausbildung = ''
        }

        let arbeitsplatz
        if (document.getElementById('Fahrer').checked) {
            arbeitsplatz = 0
        } else if (document.getElementById('Koch').checked) {
            arbeitsplatz = 1
        } else if (document.getElementById('Telefonannahme').checked) {
            arbeitsplatz = 2
        } else {
            arbeitsplatz = ''
        }

        let vorerfahrung
        if (document.getElementById('ja').checked || document.getElementById('nein').checked){
            vorerfahrung = document.getElementById('ja').checked ? 0 : 1
        } else {
            vorerfahrung = ''
        }

        let vorname = document.getElementById('Vname').value
        let nachname = document.getElementById('Nname').value
        let email = document.getElementById('email').value
        let telefonnummer = document.getElementById('tel').value
        let adresse = document.getElementById('adresse').value
        let plz = document.getElementById('plz').value
        let ort = document.getElementById('ort').value
        if (!anrede || anrede == '') {
            alert('Wählen Sie eine Anrede aus')
        } else if (schulausbildung === '') {
            alert('Wählen Sie eine Schulausbildung aus')
        } else if (arbeitsplatz === '') {
            alert('Wählen Sie einen Arbeitsplatz aus')
        } else if (vorerfahrung === '') {
            alert('Wählen geben Sie an, ob Sie bereits Vorerfahrung haben')
        } else if (!vorname || vorname == '') {
            alert('Überprüfen Sie den Vornamen')
        } else if (!nachname || nachname == '') {
            alert('Überprüfen Sie den Nachnamen')
        } else if (!email || email == '') {
            alert('Überprüfen Sie die E-Mail')
        } else if (!telefonnummer || telefonnummer == '') {
            alert('Überprüfen Sie die Telefonnummer')
        } else if (!adresse || adresse == '') {
            alert('Überprüfen Sie die Adresse')
        } else if (!plz || plz == '') {
            alert('Überprüfen Sie die Postleitzahl')
        } else if (!ort || ort == '') {
            alert('Überprüfen Sie den Ort')
        } else {
            let kunde = {
                anrede,
                vorname,
                nachname,
                email,
                telefonnummer,
                adresse,
                plz,
                ort
            }
            
            let bewerberObj = {
                kunde,
                schulausbildung,
                arbeitsplatz,
                vorerfahrung
            }
            console.log(bewerberObj)
            $.ajax({
                url: 'http://localhost:8000/webanw2/bewerber',
                method: 'post',
                dataType: 'json',
				contentType: 'application/json',
				data: JSON.stringify(bewerberObj)
            }).done(function (response) {
				let bewerber = response.daten
                if (bewerber) {
                    document.getElementById('formular').innerHTML = ''
                    document.getElementById('nachBewerbung').innerHTML = `Vielen Dank ${bewerber.kunde.anrede} ${bewerber.kunde.nachname}, Ihre Bewerbung wurde erfolgreich abgeschickt.`
                }
                console.log(bewerber)                
			}).fail(function (jqXHR, statusText, error) {
                console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
                $('#ergebnisbestellung').html('Ein Fehler ist aufgetreten');
            })
        }
    }

    function gesamtMenge() {
			let arrayBestellpositionen = JSON.parse(getSessionItem('bestellpositionen')) || []
			if (arrayBestellpositionen.length > 0) {
				let gesamt = arrayBestellpositionen.map(b => b.menge).reduce((acc, cur) => {
								return acc + cur
							})
				return gesamt
			} else {
				return 0
			}
		}
		let cart = document.getElementById('cart')
		cart.innerHTML = 'Warenkorb (' + gesamtMenge() + ')'

</script>
